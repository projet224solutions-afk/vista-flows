// This file is automatically generated. Do not edit it directly.
import { createClient } from '@supabase/supabase-js';
import type { Database } from './types';

// Configuration Supabase avec valeurs par d√©faut pour production
const SUPABASE_URL = 'https://uakkxaibujzxdiqzpnpr.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVha2t4YWlidWp6eGRpcXpwbnByIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwMDA2NTcsImV4cCI6MjA3NDU3NjY1N30.kqYNdg-73BTP0Yht7kid-EZu2APg9qw-b_KW9z5hJbM';

console.log('üîß [Supabase Client] Configuration:', {
  url: SUPABASE_URL,
  keyPresent: !!SUPABASE_KEY,
  keyLength: SUPABASE_KEY?.length
});

// Import the supabase client like this:
// import { supabase } from "@/integrations/supabase/client";

export const supabase = createClient<Database>(SUPABASE_URL, SUPABASE_KEY, {
  auth: {
    storage: localStorage,
    persistSession: true,
    autoRefreshToken: true,
    detectSessionInUrl: true,
    flowType: 'pkce',
  },
  global: {
    headers: {
      'X-Client-Info': '224solutions-web',
    },
  },
});

// Fonction pour rafra√Æchir manuellement la session si elle expire
export const refreshSession = async () => {
  try {
    const { data, error } = await supabase.auth.refreshSession();
    if (error) {
      console.error('‚ùå Erreur rafra√Æchissement session:', error);
      return null;
    }
    console.log('‚úÖ Session rafra√Æchie avec succ√®s');
    return data.session;
  } catch (e) {
    console.error('‚ùå Exception rafra√Æchissement session:', e);
    return null;
  }
};

// V√©rification p√©riodique de la session (toutes les 5 minutes)
let sessionCheckInterval: ReturnType<typeof setInterval> | null = null;

export const startSessionMonitor = () => {
  if (sessionCheckInterval) return;
  
  sessionCheckInterval = setInterval(async () => {
    const { data: { session } } = await supabase.auth.getSession();
    if (session) {
      // V√©rifier si le token expire dans moins de 10 minutes
      const expiresAt = session.expires_at || 0;
      const now = Math.floor(Date.now() / 1000);
      const timeUntilExpiry = expiresAt - now;
      
      if (timeUntilExpiry < 600 && timeUntilExpiry > 0) {
        console.log('‚ö†Ô∏è Session expire bient√¥t, rafra√Æchissement...');
        await refreshSession();
      }
    }
  }, 5 * 60 * 1000); // Toutes les 5 minutes
};

export const stopSessionMonitor = () => {
  if (sessionCheckInterval) {
    clearInterval(sessionCheckInterval);
    sessionCheckInterval = null;
  }
};